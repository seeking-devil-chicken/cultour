// server/__tests__/events.test.ts
import { describe, it, expect, beforeEach, afterAll } from 'vitest';
import request from 'supertest';
import app from '../server.js';
import db from '../models/database.js'; // Import db to setup/teardown

beforeEach(async () => {
  // Clear tables to start fresh
  await db.query('TRUNCATE TABLE posts, events RESTART IDENTITY', []);

  // Seed posts (for image fallback test)
  await db.query(
    `INSERT INTO "public"."posts" ("id", "user_id", "country", "category", "title", "text", "image", "created_at") VALUES ('2', '1', 'Vietnam', 'Food', 'Pho Bo', 'A classic Vietnamese noodle soup with rich beef broth, rice noodles, and fresh herbs like basil, cilantro, and mint.', 'https://petazi.com/demo/images/phobo.jpg', '2025-11-11 19:01:54.126638'), ('3', '2', 'Vietnam', 'Games', 'Đá Cầu', 'A traditional game played by kicking a feathered shuttlecock, similar to badminton but using feet. It requires skill and balance.', 'https://petazi.com/demo/images/dacau.jpg', '2025-11-11 19:01:54.126638'), ('4', '1', 'Vietnam', 'Customs', 'Tục Lì Xì (Lucky Money)', 'During Tết (Lunar New Year), elders give lucky money in red envelopes to children, wishing them good health and success.', 'https://petazi.com/demo/images/lucky.jpg', '2025-11-11 19:01:54.126638'), ('5', '3', 'Vietnam', 'Rituals', 'Thắp Hương (Incense Offering)', 'A common ritual of burning incense to pay respects to ancestors at the family altar, especially on the 1st and 15th of the lunar month.', 'https://petazi.com/demo/images/thaphuong.jpg', '2025-11-11 19:01:54.126638'), ('6', '2', 'Vietnam', 'Media', 'Múa Rối Nước', 'A unique water puppetry performance, depicting rural life, legends, and national history, performed in a waist-deep pool.', 'https://petazi.com/demo/images/puppet.jpg', '2025-11-11 19:01:54.126638'), ('7', '4', 'Japan', 'Food', 'Nigiri Sushi', 'A traditional Japanese dish of vinegared rice topped with a slice of ingredient, usually raw fish or seafood. Served with soy sauce and wasabi.', 'https://petazi.com/demo/images/nigiri-sushi.jpg', '2025-11-11 19:01:54.126638'), ('8', '5', 'Japan', 'Games', 'Kendama', 'A traditional Japanese skill toy. The goal is to catch the ball on different cups and the spike, requiring coordination and practice.', 'https://petazi.com/demo/images/kendama.jpg', '2025-11-11 19:01:54.126638'), ('9', '4', 'Japan', 'Customs', 'Genkan Etiquette', 'The custom of removing shoes at the "genkan" (entranceway) before entering a home to keep the inside clean and show respect.', 'https://petazi.com/demo/images/genkan.jpg', '2025-11-11 19:01:54.126638'), ('10', '6', 'Japan', 'Rituals', 'Japanese Tea Ceremony (Sadō)', 'A ceremonial preparation and presentation of matcha, embodying harmony, respect, purity, and tranquility.', 'https://petazi.com/demo/images/tea.jpg', '2025-11-11 19:01:54.126638'), ('11', '5', 'Japan', 'Media', 'Studio Ghibli Films', 'Watch acclaimed animated films like "My Neighbor Totoro" or "Spirited Away" to experience masterful Japanese storytelling and art.', 'https://petazi.com/demo/images/studio.jpg', '2025-11-11 19:01:54.126638'), ('12', '7', 'United States', 'Food', 'Thanksgiving Turkey', 'A roasted turkey is the traditional centerpiece of the Thanksgiving holiday meal, often served with stuffing, cranberry sauce, and mashed potatoes.', 'https://petazi.com/demo/images/turkey.jpg', '2025-11-11 19:01:54.126638'), ('13', '8', 'United States', 'Games', 'American Football (Tailgating)', 'A hugely popular sport. A common cultural activity is to "tailgate" (have a BBQ party) in the stadium parking lot before the game.', 'https://petazi.com/demo/images/football.jpg', '2025-11-11 19:01:54.126638'), ('14', '7', 'United States', 'Customs', 'Tipping Culture', 'The custom of tipping service workers (like waiters, bartenders, and drivers) around 15-20% of the bill to show appreciation for good service.', 'https://petazi.com/demo/images/tipping.jpg', '2025-11-11 19:01:54.126638'), ('15', '9', 'United States', 'Rituals', 'Carving Jack-o''-lanterns', 'A popular Halloween ritual where people carve spooky or funny faces into pumpkins and place a candle inside.', 'https://petazi.com/demo/images/jack.jpg', '2025-11-11 19:01:54.126638'), ('16', '8', 'United States', 'Media', 'Summer Blockbuster Movie', 'The tradition of going to the cinema to watch big-budget "blockbuster" films, a major part of American media culture, especially in summer.', 'https://petazi.com/demo/images/movie.jpg', '2025-11-11 19:01:54.126638');`,
    []
  );

  // Seed events (past, future, different countries, null image)
  await db.query(
    `INSERT INTO "public"."events" ("id", "event_city", "event_title", "event_datetime", "address", "description", "image", "ticket_price", "website_url", "country", "category") VALUES ('1', 'New York', 'New York African Restaurant Week Festival', '2025-11-15 17:00:00+00', 'Various locations, Manhattan, NY', 'A celebration of African cuisine and culture featuring tastings from multiple restaurants, live music, and cultural performances showcasing African heritage.', '', 'Starting at $50', 'https://www.eventbrite.com/d/ny--new-york/food-and-drink--festivals/', 'African Nations', 'Food'), ('2', 'New York', 'Korea Fest', '2025-11-22 15:00:00+00', 'Flushing Meadows-Corona Park, Queens, NY', 'An immersive festival dedicated to Korean culture, including traditional foods like bibimbap and kimchi, K-pop performances, and skincare demonstrations.', '', 'Free entry, food purchases extra', 'https://www.cozymeal.com/magazine/food-festivals-nyc', 'South Korea', 'Food'), ('3', 'New York', 'Thai Fest', '2025-11-29 16:00:00+00', 'Industry City, Brooklyn, NY', 'A vibrant showcase of Thai street food such as pad thai and mango sticky rice, alongside cultural dances and music from Thailand.', '', 'Free, ticketed tastings from $20', 'https://www.cozymeal.com/magazine/food-festivals-nyc', 'Thailand', 'Food'), ('4', 'New York', 'Bronx Night Market', '2025-12-06 23:00:00+00', 'Bronx, NY', 'Evening market highlighting Bronx multicultural food scene with over 60 vendors offering global dishes like mac and cheese burritos and Caribbean specialties.', '', 'Free entry', 'https://www.cozymeal.com/magazine/food-festivals-nyc', 'Various Latin American & Caribbean', 'Food'), ('5', 'New York', 'Waffle Games Esports and Game Design Conference', '2025-11-14 14:00:00+00', 'Various venues, Manhattan, NY', 'A hybrid convention featuring traditional and digital games, esports tournaments, and workshops on game design with cultural elements from diverse backgrounds.', '', 'From $25', 'https://www.nyc.gov/site/mome/industries/nyc-summer-of-games.page', 'Various', 'Games'), ('6', 'New York', 'Games for Change Festival', '2025-11-20 15:00:00+00', 'MoMA PS1, Queens, NY', 'Festival exploring games as tools for social change, including sessions on cultural storytelling through interactive media and global game demos.', '', 'From $100', 'https://www.nyc.gov/site/mome/industries/nyc-summer-of-games.page', 'Various', 'Games'), ('7', 'New York', 'Bastille Day Festival', '2025-07-13 17:00:00+00', 'Madison Avenue between 59th and 63rd St, Manhattan, NY', 'Note: Date adjusted to upcoming equivalent; French cultural fair with traditional customs, booths, live performances, and family activities celebrating French heritage.', '', 'Free', 'https://www.manhattanbuzz.nyc/article/17/manhattan-street-fairs---street-festivals-in-manhattan-nyc', 'France', 'Customs'), ('8', 'New York', 'Go Africa Carnival', '2025-11-16 15:00:00+00', 'West 116th Street between Adam Clayton Powell Blvd and Frederick Douglass Blvd, Harlem, NY', 'Annual carnival showcasing African and Caribbean customs through music, art, shopping, and street parades highlighting traditional attire and dances.', '', 'Free', 'https://www.manhattanbuzz.nyc/article/17/manhattan-street-fairs---street-festivals-in-manhattan-nyc', 'African Nations', 'Customs'), ('9', 'New York', 'The Big Shabbat', '2025-11-21 23:00:00+00', 'Javits North, Manhattan, NY', 'A large-scale communal Shabbat dinner ritual for 3,000 people, featuring Jewish prayers, songs, and shared meals to foster community and tradition.', '', 'From $36', 'https://www.timeout.com/newyork/events-calendar/november-events-calendar', 'Israel/Jewish', 'Rituals'), ('10', 'New York', 'Rockefeller Center Christmas Tree Lighting', '2025-12-04 00:00:00+00', 'Rockefeller Center, Manhattan, NY', 'Iconic holiday ritual with live performances, celebrity hosts, and the lighting of the massive Christmas tree, symbolizing festive traditions worldwide.', '', 'Free viewing', 'https://mychristmasinnewyork.com/new-york-christmas-2025-dates-events/', 'United States/European', 'Rituals'), ('11', 'New York', 'New York Comedy Festival', '2025-11-07 23:00:00+00', 'Various venues across NYC', 'A festival of stand-up and sketch comedy shows, panels, and performances sharing global humor and cultural satire through media and live arts.', '', 'From $20', 'https://www.timeout.com/newyork/events-calendar/november-events-calendar', 'Various', 'Media'), ('12', 'New York', 'DOC NYC Film Festival', '2025-11-12 17:00:00+00', 'IFC Center, Village East, SVA Theater, Manhattan, NY', 'America''s largest documentary festival screening films on global cultures, histories, and social issues, with Q&As and panels.', '', 'From $15 per screening', 'https://www.nytimes.com/2025/11/01/arts/fun-things-to-do-nyc-november-2025.html', 'Various', 'Media'), ('13', 'New York', 'Performa Biennial Performance Art Festival', '2025-11-01 15:00:00+00', 'Various locations, NYC', 'Biennial of innovative performance art blending music, theater, and visual media to explore cultural narratives and contemporary issues.', '', 'Varies by event', 'https://www.nytimes.com/2025/11/01/arts/fun-things-to-do-nyc-november-2025.html', 'Various', 'Media'), ('14', 'New York', 'Wifredo Lam: When I Don’t Sleep, I Dream', '2025-11-10 15:00:00+00', 'MoMA, Manhattan, NY', 'Exhibition of Cuban artist Wifredo Lam''s paintings and works exploring Afro-Cuban cultural fusion through surrealist media.', '', '$30 adult ticket', 'https://ocula.com/cities/usa/new-york-art-galleries/exhibitions/', 'Cuba', 'Media'), ('15', 'New York', 'Harmony and Dissonance: Orphism in Paris, 1910–1930', '2025-11-08 15:00:00+00', 'Solomon R. Guggenheim Museum, Manhattan, NY', 'Exploration of Orphism art movement with over 80 works blending music, poetry, and abstract painting from early 20th-century Paris.', '', '$30 adult ticket', 'https://gothamtogo.com/art-installations-exhibitions-in-nyc-november-2024/', 'France', 'Media'), ('16', 'New York', 'Flight into Egypt: Black Artists and Ancient Egypt, 1876–Now', '2025-11-17 15:00:00+00', 'The Metropolitan Museum of Art, Manhattan, NY', 'Exhibition tracing Black artists'' engagement with ancient Egyptian themes through paintings, sculptures, and multimedia cultural expressions.', '', '$30 adult ticket', 'https://gothamtogo.com/art-installations-exhibitions-in-nyc-november-2024/', 'African Diaspora/Egypt', 'Media'), ('17', 'New York', 'Renoir Drawings', '2025-10-17 15:00:00+00', 'Morgan Library & Museum, Manhattan, NY', 'Major showing of Pierre-Auguste Renoir''s drawings, highlighting French impressionist techniques and cultural influences in visual media.', '', '$25 adult ticket', 'https://www.timeout.com/newyork/attractions/best-museum-exhibitions-in-nyc', 'France', 'Media'), ('18', 'New York', 'Gabriele Münter: Contours of a World', '2025-11-07 15:00:00+00', 'The Jewish Museum, Manhattan, NY', 'Retrospective of German expressionist Gabriele Münter''s paintings and photographs, exploring early 20th-century cultural shifts.', '', '$18 adult ticket', 'https://www.cntraveler.com/story/art-exhibits-nyc', 'Germany', 'Media'), ('19', 'New York', 'Helen Frankenthaler: A Grand Sweep', '2025-11-18 15:00:00+00', 'Guggenheim Museum, Manhattan, NY', 'Exhibition of abstract expressionist Helen Frankenthaler''s innovative paintings and prints, reflecting American post-war cultural media.', '', '$30 adult ticket', 'https://www.cntraveler.com/story/art-exhibits-nyc', 'United States', 'Media'), ('20', 'New York', 'Mission: Impossible—Story and Spectacle', '2025-11-01 17:00:00+00', 'Museum of the Moving Image, Astoria, Queens, NY', 'Interactive exhibit on the Mission: Impossible film franchise, showcasing stunts, props, and cultural impact of Hollywood action media.', '', '$20 adult ticket', 'https://www.timeout.com/newyork/attractions/best-museum-exhibitions-in-nyc', 'United States', 'Media'), ('21', 'New York', 'Queens International Night Market', '2025-11-15 21:00:00+00', 'Flushing Meadows-Corona Park, Queens, NY', 'A family-friendly open-air market celebrating NYC''s cultural diversity with over 100 vendors offering international cuisines from Afghanistan, Colombia, Ukraine, and more, alongside art, merchandise, and live performances.', '', 'Free entry, food purchases extra', 'https://www.cozymeal.com/magazine/food-festivals-nyc', 'Various International', 'Food'), ('22', 'New York', 'Harlem Week International Food Festival', '2025-11-23 16:00:00+00', 'Various locations in Harlem, Manhattan, NY', 'Part of Harlem Week, this festival highlights global cuisines from over 20 countries through tastings, vendor booths, and cultural demonstrations fostering community and culinary exchange.', '', 'Free entry', 'https://www.nimbuskitchen.com/blog/nycs-2025-food-festivals-amp-markets-where-to-apply-and-how-to-get-in', 'Various African & Caribbean', 'Food'), ('23', 'New York', 'NYC Video Game Festival', '2025-11-29 14:00:00+00', 'Convene Brookfield Place, 225 Liberty St, Manhattan, NY', 'A celebration of digital gaming culture featuring indie demos, VR experiences, cosplay, and esports tournaments with global influences, including the Mayor’s Cup Minecraft Challenge.', '', 'Free entry', 'https://www.nyc.gov/site/mome/news/04242025-nyc-video-game-festival.page', 'Various', 'Games'), ('24', 'New York', 'PAX Unplugged', '2025-12-06 15:00:00+00', 'Pennsylvania Convention Center, Philadelphia (accessible from NYC)', 'A major tabletop gaming festival with international board game designers, cultural demos, and tournaments showcasing global game traditions and innovations.', '', 'From $40', 'https://www.gamesindustry.biz/events?year=2025', 'Various', 'Games'), ('25', 'New York', 'NYC Multicultural Festival Finale', '2025-11-22 17:00:00+00', 'Various outdoor locations, Manhattan, NY', 'The grand finale of a citywide event with stages of live music, dance, and interactive workshops exploring multicultural customs from around the world.', '', 'Free', 'https://multiculturalfestival.nyc/', 'Various International', 'Customs'), ('26', 'New York', 'Veterans Day Parade', '2025-11-11 17:30:00+00', 'Fifth Avenue, Manhattan, NY', 'An annual tribute to veterans with parades, floats, and ceremonies reflecting American military customs and international alliances through participating groups.', '', 'Free viewing', 'https://www.timeout.com/newyork/events-calendar/november-events-calendar', 'United States', 'Customs'), ('27', 'New York', 'Kwanzaa Celebration at AMNH', '2025-12-26 17:00:00+00', 'American Museum of Natural History, Central Park West, Manhattan, NY', 'A vibrant Kwanzaa event honoring African American heritage with traditional dances, music, crafts, and principles of unity, self-determination, and collective work.', '', 'Free with museum admission', 'https://www.nyctourism.com/annual-events/', 'African American Heritage', 'Rituals'), ('28', 'New York', 'Macy''s Thanksgiving Day Parade', '2025-11-27 14:00:00+00', 'Central Park West to Herald Square, Manhattan, NY', 'Iconic American ritual featuring giant balloons, floats, marching bands, and performances, drawing on global cultural influences through diverse participants.', '', 'Free viewing', 'https://www.timeout.com/newyork/events-calendar/november-events-calendar', 'United States', 'Rituals'), ('29', 'New York', 'American Film Market', '2025-11-12 14:00:00+00', 'Loews Santa Monica Beach Hotel (NYC screenings), Manhattan, NY', 'Global film industry event with international market screenings, panels, and networking focused on diverse cinematic storytelling from around the world.', '', 'Varies by access', 'https://www.screendaily.com/news/2025-film-festivals-and-markets-calendar-latest-dates/5200079.article', 'Various International', 'Media'), ('30', 'New York', 'New York City International Film Festival', '2025-11-14 23:00:00+00', 'Dolby Screening Room, 1350 6th Ave, Manhattan, NY', 'A showcase of independent films from emerging international filmmakers, emphasizing diverse narratives through features, shorts, and documentaries.', '', 'From $15 per screening', 'https://filmfreeway.com/NEWYORKCITYINTERNATIONALFILMFESTIVALNYCIFF', 'Various International', 'Media'), ('31', 'New York', 'Harvest 2025 Festival', '2025-11-13 17:00:00+00', 'Union Square, Manhattan, NY', 'A fall celebration featuring diverse international foods, live music, and cultural performances from around the world, highlighting NYC''s multicultural harvest traditions.', '', 'Free entry, purchases extra', 'https://www.timeout.com/newyork/events-calendar/november-events-calendar', 'Various International', 'Food'), ('32', 'New York', 'JAANJ Japanese Food Festival', '2025-11-09 15:00:00+00', 'Overpeck County Park, Ridgefield Park, NJ (accessible from NYC)', 'A major Japanese food festival showcasing authentic cuisine like sushi and ramen, alongside cultural demos and traditional games from Japan.', '', 'Free admission', 'https://www.reddit.com/r/FoodNYC/comments/1oq0i9l/new_yorkarea_food_events_november_613/', 'Japan', 'Food'), ('33', 'New York', 'Grand Central Food Festival', '2025-11-06 15:00:00+00', 'West 45th St. between Lexington and Third Aves., Manhattan, NY', 'A vibrant food event with global vendors offering international street foods and cultural tastings in the heart of Midtown.', '', 'Free admission', 'https://www.reddit.com/r/FoodNYC/comments/1oq0i9l/new_yorkarea_food_events_november_613/', 'Various International', 'Food'), ('34', 'New York', 'Smorgasburg Winter Market', '2025-12-07 16:00:00+00', 'Industry City, Brooklyn, NY', 'Indoor winter edition of NYC''s premier food market featuring diverse global cuisines from over 100 vendors, celebrating international culinary traditions.', '', 'Free entry, food purchases extra', 'https://visitnyc.com/events/cultural-festivals-in-brooklyn-a-year-round-guide-6605/', 'Various International', 'Food'), ('35', 'New York', 'Anime NYC', '2025-08-22 15:00:00+00', 'Javits Center, 655 W 34th St, Manhattan, NY', 'Massive anime convention with Japanese cultural games, cosplay contests, and interactive experiences showcasing pop culture and traditions.', '', 'From $60', 'https://www.manhattanbuzz.nyc/article/17/manhattan-street-fairs---street-festivals-in-manhattan-nyc', 'Japan', 'Games'), ('36', 'New York', 'Day of the Dead Celebration at Bronx Zoo', '2025-11-01 16:00:00+00', 'Bronx Zoo, Bronx, NY', 'Family-friendly event honoring Mexican traditions with cultural games, music, and activities focused on Latin American heritage.', '', '$30 adult ticket', 'https://www.reddit.com/r/nyc/comments/1o44kzp/things_to_do_in_nyc_november_2025/', 'Mexico', 'Games'), ('37', 'New York', 'Salute to Israel Parade', '2025-06-01 16:00:00+00', 'Fifth Avenue, from 57th to 79th Streets, Manhattan, NY', 'Annual parade celebrating Israeli customs with floats, traditional dances, and community marches along iconic Fifth Avenue.', '', 'Free viewing', 'https://citylore.org/urban-culture/resources/calendar-of-ethnic-festivals/', 'Israel', 'Customs'), ('38', 'New York', 'Colombian Independence Day Festival', '2025-07-20 15:00:00+00', 'Flushing Meadows Corona Park, Queens, NY', 'Vibrant celebration of Colombian independence featuring traditional customs, music, crafts, and dances in the park.', '', 'Free entry', 'https://citylore.org/urban-culture/resources/calendar-of-ethnic-festivals/', 'Colombia', 'Customs'), ('39', 'New York', 'Feast of San Gennaro', '2025-09-12 17:00:00+00', 'Little Italy, Mulberry St, Manhattan, NY', 'Italian-American festival honoring Neapolitan rituals with religious processions, live entertainment, and cultural parades spanning 11 blocks.', '', 'Free entry', 'https://cititour.com/NYC_News/Ultimate-Guide-to-NYC-Food-Festivals-in-2025/9220', 'Italy', 'Rituals'), ('40', 'New York', 'Kwanzaa at Apollo Theater', '2025-12-26 17:00:00+00', 'Apollo Theater, 253 W 125th St, Harlem, Manhattan, NY', 'Annual celebration of African-American rituals with performances, family activities, and a marketplace highlighting Kwanzaa principles.', '', 'Varies by event', 'https://likealocaltours.com/blog/nyc-festivals', 'African American Heritage', 'Rituals'), ('41', 'New York', 'NYC Winter Jazzfest', '2025-01-09 23:00:00+00', 'Various venues across Manhattan, NY', 'Premier jazz festival blending global musical traditions through innovative performances and cultural storytelling in intimate NYC spots.', '', 'From $50', 'https://www.festyful.com/guides/2025/north-america/united-states/new-york-city', 'Various International', 'Media'), ('42', 'New York', 'Tribeca Festival', '2025-06-04 15:00:00+00', 'Various locations in Tribeca, Manhattan, NY', 'Renowned festival celebrating global cinema, music, and media with films, talks, and performances exploring diverse cultural narratives.', '', 'Passes from $100', 'https://www.nyctourism.com/annual-events/', 'Various International', 'Media'), ('43', 'New York', 'New York International Children''s Film Festival', '2025-10-17 17:00:00+00', 'Various venues, Manhattan, NY', 'Showcase of international youth films highlighting global stories and cultural perspectives through animation and live-action.', '', 'From $15', 'https://www.nyctourism.com/annual-events/', 'Various International', 'Media'), ('44', 'New York', 'Ninth Avenue International Food Festival', '2025-05-17 15:00:00+00', 'Ninth Avenue between West 37th and West 57th Streets, Manhattan, NY', 'Annual festival showcasing international cuisines from around the world with over 100 vendors offering global street foods, live entertainment, and cultural booths celebrating diverse food traditions.', '', 'Free entry, food purchases extra', 'https://www.nyctourism.com/annual-events/', 'Various International', 'Food'), ('45', 'New York', 'Japan Fes', '2025-07-26 16:00:00+00', 'Brooklyn Expo Center, Greenpoint, Brooklyn, NY', 'Largest Japanese cultural festival in NYC featuring authentic Japanese foods like sushi and ramen, taiko drumming, cosplay, and traditional games sharing Japanese heritage.', '', 'From $15', 'https://www.cozymeal.com/magazine/food-festivals-nyc', 'Japan', 'Food'), ('46', 'New York', 'New York Comic Con', '2025-10-09 15:00:00+00', 'Javits Center, 655 W 34th St, Manhattan, NY', 'Major pop culture convention with international comics, anime, gaming panels, cosplay, and interactive exhibits highlighting global media and gaming cultures.', '', 'From $50', 'https://www.nyctourism.com/annual-events/', 'Various International', 'Games'), ('47', 'New York', 'Turkish Day Parade', '2025-05-25 18:00:00+00', 'Madison Avenue from 38th to 74th Streets, Manhattan, NY', 'Vibrant parade celebrating Turkish customs with floats, traditional costumes, folk dances, and music performances promoting Turkish-American cultural heritage.', '', 'Free viewing', 'https://citylore.org/urban-culture/resources/calendar-of-ethnic-festivals/', 'Turkey', 'Customs'), ('48', 'New York', 'Greek Independence Day Parade', '2025-04-13 18:00:00+00', 'Fifth Avenue from 64th to 79th Streets, Manhattan, NY', 'Annual parade honoring Greek independence with traditional costumes, floats, and performances representing Greek cultural identities and heritage.', '', 'Free viewing', 'https://citylore.org/urban-culture/resources/calendar-of-ethnic-festivals/', 'Greece', 'Customs'), ('49', 'New York', 'Hanukkah Menorah Lighting', '2025-12-18 23:00:00+00', 'Grand Army Plaza, Brooklyn, NY', 'Public ritual lighting of a giant menorah celebrating Jewish Hanukkah traditions with prayers, songs, dreidel games, and sufganiyot sharing Jewish customs.', '', 'Free', 'https://www.holidify.com/pages/festivals-in-new-york-city-5817.html', 'Israel/Jewish', 'Rituals'), ('50', 'New York', 'NYC Winter Jazzfest', '2025-01-09 23:00:00+00', 'Various venues, Manhattan, NY', 'Multi-venue jazz festival featuring international artists blending global musical traditions through performances and cultural storytelling in NYC.', '', 'From $50', 'https://www.timeout.com/newyork/events-calendar', 'Various International', 'Media');`,
    []
  );
});

describe('GET /api/events', () => {
  it('should return only future events by default', async () => {
    const res = await request(app).get('/api/events');

    // console.log(res.body);

    expect(res.statusCode).toBe(200);
    expect(res.body.length).toBe(22);
    expect(res.body[0].event_title).toBe(
      'Waffle Games Esports and Game Design Conference'
    );
  });

  it('should filter by country=Various', async () => {
    const res = await request(app).get('/api/events?country=Various');

    // console.log(res.body);

    expect(res.statusCode).toBe(200);
    expect(res.body.length).toBe(4);
    expect(res.body[0].country).toBe('Various');
  });

  it('should filter by a date range', async () => {
    const res = await request(app).get(
      '/api/events?startDate=2025-11-15&endDate=2025-12-25'
    );

    // console.log('res.body: ', res.body);

    expect(res.statusCode).toBe(200);
    expect(res.body.length).toBe(18);
    expect(res.body[0].event_title).toBe(
      'New York African Restaurant Week Festival'
    );
  });

  it('should return an empty array for no results', async () => {
    const res = await request(app).get('/api/events?country=Vietnam');
    expect(res.statusCode).toBe(200);
    expect(res.body.length).toBe(0);
  });
});
